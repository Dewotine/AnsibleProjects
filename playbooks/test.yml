---
- hosts: "{{ filter }}:&dc_{{ dc }}"
# - hosts: "vps528223.ovh.net"
#- hosts: "piwigo"
  become: true
  vars:
    my_piwigo_user:
      user1:
        password: "password1"
        email: "essai10@gmail.com"
      user2:
        password: "password2"
        email: "essai20@gmail.com"
      ratatouille:
        password: "password3"
        email: "essai40@gmail.com"
  tasks:
    - name: "Create a list of user"
      piwigo_user:
        name: "{{ item.key }}"
        password: "{{ item.value.password }}"
        email: "{{ item.value.email }}"
        send_password_by_mail: false
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"
        state: "present"
      with_dict: "{{ my_piwigo_user }}"
    - name: "Create a user with extra attributes"
      piwigo_user:
        name: "mytest"
        password: "password"
        email: "mynewtest@gamil.com"
        group:
          - testgroup
          - testgroup2
        level: 1
        status: "admin"
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"
        state: "present"
    - name: "Delete a user"
      piwigo_user:
        name: "user2"
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"
        state: "absent"
    - name: "Modify a user"
      piwigo_user:
        name: "user1"
        email: "newessai10@gmail.com"
        state: "present"
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"


    - name: "Test of group creation without associated user"
      piwigo_group:
        name: "testgroupwithoutuser"
        state: "present"
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"

    - name: "Test of group creation with associated users"
      piwigo_group:
        name: "testgroupwithusers"
        state: "present"
        user_list:
          - "user1"
          - "user3"
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"

    - name: "Test of group deletion"
      piwigo_group:
        name: "testgroupwithoutuser"
        state: "absent"
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"

    - name: "Un petit essai de creation de categorie"
      piwigo_category:
        name: "Categorie3"
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"
        state: "present"

    - name: "Un petit essai de creation de categorie"
      piwigo_category:
        name: "ma categorie test"
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"
        state: "present"

    - name: "Update status of a category"
      piwigo_category:
        name: "Categorie3"
        comment: "Test Ansible3"
        status: "private"
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"
        state: "present"

    - name: "Delete a category"
      piwigo_category:
        name: "Categorie3"
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"
        state: "absent"

    - name: "Test autorisation"
      piwigo_permissions:
        cat_name:
          - "ma categorie test"
        user_name:
          - "essai2"
          - "testonze"
          - "essai3"
          - "essai1"
        group_name:
          - "testgroup"
          - "testgroup2"
        url_username: "piwigo_admin"
        url_password: "H€2cumzv"
        url: "http://piwigo.bleschet.fr:8080"